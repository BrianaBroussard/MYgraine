{% extends 'base.html' %}
{% block title %}MYgraine - dashboard {% endblock %}

{% block head %} 
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.5.1/dist/chart.min.js"></script>
{# randomColor: generate random colors #}
<script src="https://cdn.jsdelivr.net/npm/randomcolor@0.6.2/randomColor.js"></script>


<!-- FullCalendar -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.0.0/index.global.min.js"></script>

{% endblock %}




{% block body %}
  <h1>{{user.name}} Profile </h1>

  <p>
    <form action = "/go-to-headache-log">
        <button type="submit">Add Headache</button>
    </form>
  </p>

  <h2>Your Logged Headaches</h2>
  <div>
    {% for headache in user.headaches %}    
    <p> {{headache.headache_type}} - Date: {{headache.date_start}} - {{headache.date_end}} 
        Pain: {{headache.pain_scale}} / 10
     {% if headache.additional_notes %}
      Notes: {{headache.additional_notes}} 
     {% endif %}
    </p>
    {% endfor %}  
  </div>

  <h2>Your Possible Triggers</h2>
  <div>
    {% for triggername, triggercount in dict_users_triggers.items() %}  
     
    <p> 
        {{triggername}} - {{triggercount}}
    </p>
   
    {% endfor %}  
  </div>

  <h2> Trigger Chart</h2>

  <canvas id="trigger-chart"></canvas>

  <script src="/static/charts.js"></script>



  <h2>Headache Calendar</h2>
  <div id='calendar'></div>

  <script>document.addEventListener('DOMContentLoaded', function() {
    let calendarEl = document.getElementById('calendar');
let calendar = new FullCalendar.Calendar(calendarEl, {
  initialView: 'dayGridMonth', 
  events: [
   {% for headache in user.headaches %} 
   {
     id: '{{ headache.headache_id }}',
     title: '{{headache.headache_type}}',
     start: '{{headache.date_start}}',
     end: '{{headache.date_end}}',     
   },
   {% endfor %}    
 ],
});
calendar.render();
});

</script>

{% endblock %}